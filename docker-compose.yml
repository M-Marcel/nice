version: '3.8'

services:
    react-app:
        image: lanepact-test
        build:
            context: .
            dockerfile: Dockerfile
            args:
                REACT_APP_ENV: ${REACT_APP_ENV}
                REACT_APP_BASEURL: ${REACT_APP_BASEURL}
        restart: always
        networks:
            - lanepact-network
        ports:
            - '3000:80'
        environment:
            - REACT_APP_ENV=${REACT_APP_ENV}
            - REACT_APP_BASEURL=${REACT_APP_BASEURL}
        labels:
            - traefik.enable=true
            - traefik.http.routers.react-app.rule=Host(`react-app.lanepact.com`)
            - traefik.http.services.react-app.loadbalancer.server.port=80
            - traefik.http.routers.react-app.entrypoints=websecure
            - traefik.http.routers.react-app.tls=true
            - traefik.http.routers.react-app.tls.certresolver=myresolver
            - traefik.http.routers.react-app.middlewares=redirect-to-https@file

# Define the network
networks:
    lanepact-network:
        external: true
